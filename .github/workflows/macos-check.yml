name: macOS Check

on:
  push:
    branches:
      - main
      - master
  pull_request:
    paths:
      - 'modules/home/darwin/**'
      - 'hosts/macbook/**'
      - 'flake.nix'
      - 'flake.lock'
  workflow_dispatch:

jobs:
  macos-syntax:
    runs-on: macos-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@34e114876b0b11c390a56381ad16ebd13914f8d5 # v4.3.1

      - name: Install Nix
        uses: cachix/install-nix-action@4e002c8ec80594ecd40e759629461e26c8abed15 # v31.9.0
        with:
          nix_path: nixpkgs=channel:nixpkgs-unstable

      - name: Check Darwin modules syntax
        run: |
          if [ -d "modules/home/darwin" ]; then
            for module in modules/home/darwin/*.nix; do
              if [ -f "$module" ]; then
                echo "Checking $module"
                nix-instantiate --parse "$module" > /dev/null
              fi
            done
          else
            echo "No Darwin modules found (expected for now)"
          fi

      - name: Show flake metadata
        run: nix flake metadata

  # This job will be enabled once macOS host is configured
  # macos-home-manager:
  #   runs-on: macos-latest
  #   steps:
  #     - name: Checkout repository
  #       uses: actions/checkout@v4
  #
  #     - name: Install Nix
  #       uses: cachix/install-nix-action@v31
  #
  #     - name: Build Home Manager configuration
  #       run: |
  #         nix build .#homeConfigurations.\"t4d4@macbook\".activationPackage
